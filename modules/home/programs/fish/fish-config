if uwsm check may-start
    exec systemd-cat --identifier=hyprland-session uwsm start hyprland-uwsm.desktop
end
if status is-interactive
    # Commands to run in interactive sessions can go here
    set -U fish_greeting
    zoxide init fish | source
    if test "$SHLVL" -eq 1
        fastfetch
    end
end
alias -- l='eza -lbF --git --icons'
alias -- lS='eza -1 --icons'
alias -- la='eza -lbhHigUmuSa --time-style=long-iso --git --icons --color-scale all'
alias -- ll='eza -lbGF --git --icons'
alias -- llm='eza -lbGd --git --sort=modified --icons'
alias -- ls='eza --icons'
alias -- lt='eza --tree --level=2 --icons'
alias -- lx='eza -lbhHigUmuSa@ --time-style=long-iso --git --icons --color-scale all'
function fish_command_not_found
    set cmd $argv[1] # Extract the first argument
    set args $argv[2..-1] # Extract all other arguments
    echo "Command '$cmd' not found; attempting execution with nix run..."
    nix run nixpkgs#$cmd -- $args
end

function rp --description 'Create a Rust playground with Helix and Bacon in Ghostty'
    set template "$HOME/projects/rust-playground-template"
    set target_root "$HOME/projects/rust-playgrounds"

    if not test -d $template
        echo "Template not found: $template"
        return 1
    end

    if not test -d $target_root
        mkdir -p $target_root
    end

    set newdir (mktemp -d "$target_root/play-XXXXXX")
    if test -z "$newdir"
        echo "Failed to create playground directory"
        return 1
    end

    cp -a $template/. $newdir/
    cd $newdir

    if not type -q zellij
        echo "zellij is required for the split layout; please install it."
        return 1
    end

    set layout_path "$newdir/.zellij-layout.kdl"
    if not test -f $layout_path
        echo "Layout file missing: $layout_path"
        return 1
    end

    set start_cmd "zellij --layout $layout_path"

    if type -q direnv
        direnv allow
        set start_cmd "direnv exec $newdir zellij --layout $layout_path"
    end

    if test -n "$RP_NO_GHOSTTY" -o ! type -q ghostty
        eval $start_cmd >/dev/null 2>&1 &
        disown
        kill -s TERM $fish_pid
    end

    ghostty --title="Rust Playground" --working-directory=$newdir -e fish -lc "$start_cmd" >/dev/null 2>&1 &
    set rc $status
    disown
    if test $rc -ne 0
        echo "Ghostty failed; falling back to current terminal."
        eval $start_cmd >/dev/null 2>&1 &
        disown
    end
    kill -s TERM $fish_pid
end
